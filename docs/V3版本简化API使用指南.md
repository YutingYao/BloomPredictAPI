# è“è—»é¢„æµ‹ç³»ç»ŸV3ç‰ˆæœ¬ç®€åŒ–APIä½¿ç”¨æŒ‡å—

**åˆ›å»ºæ—¥æœŸ**: 2024å¹´8æœˆ17æ—¥  
**ç‰ˆæœ¬**: V3.0.0  
**æ–‡æ¡£ç±»å‹**: ç”¨æˆ·ä½¿ç”¨æŒ‡å—  
**ç›®æ ‡ç”¨æˆ·**: è®¡ç®—æœºå°ç™½ã€ç¯ä¿å·¥ä½œäººå‘˜ã€APIé›†æˆå¼€å‘è€…  

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†è“è—»é¢„æµ‹ç³»ç»ŸV3ç‰ˆæœ¬çš„ä½¿ç”¨æ–¹æ³•ã€‚V3ç‰ˆæœ¬é‡‡ç”¨é©å‘½æ€§çš„æç®€è®¾è®¡ï¼Œå°†å¤æ‚çš„720ä¸ªå‚æ•°ç®€åŒ–ä¸º4ä¸ªæ ¸å¿ƒå‚æ•°ï¼Œä»»ä½•äººéƒ½èƒ½è½»æ¾ä½¿ç”¨ã€‚

## ğŸ¯ V3ç‰ˆæœ¬æ ¸å¿ƒä¼˜åŠ¿

### æç®€è®¾è®¡ - åªéœ€4ä¸ªå‚æ•°
- âŒ V1ç‰ˆæœ¬éœ€è¦: 720ä¸ªæ•°å€¼å‚æ•°ï¼ˆ60å¤©Ã—12ç‰¹å¾ï¼‰
- âŒ V2ç‰ˆæœ¬éœ€è¦: 6-8ä¸ªé…ç½®å‚æ•°
- âœ… **V3ç‰ˆæœ¬åªéœ€: 4ä¸ªæ ¸å¿ƒå‚æ•°**

### é›¶é…ç½®ä½¿ç”¨
- æ— éœ€äº†è§£æŠ€æœ¯ç»†èŠ‚
- æ— éœ€å‡†å¤‡å†å²æ•°æ®
- æ— éœ€é…ç½®å¤æ‚å‚æ•°
- è¾“å…¥ä¸šåŠ¡ä¿¡æ¯å³å¯é¢„æµ‹

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥: ç¡®è®¤æœåŠ¡è¿è¡Œ

è®¿é—®å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼Œç¡®è®¤æœåŠ¡æ­£å¸¸ï¼š
```bash
# æ–¹æ³•1: ä½¿ç”¨curlå‘½ä»¤
curl http://localhost:8002/health

# æ–¹æ³•2: åœ¨æµè§ˆå™¨ä¸­è®¿é—®
http://localhost:8002/health
```

**æ­£å¸¸å“åº”ç¤ºä¾‹**:
```json
{
    "status": "healthy",
    "version": "3.0.0"
}
```

### ç¬¬äºŒæ­¥: ç¬¬ä¸€æ¬¡é¢„æµ‹è°ƒç”¨

ä½¿ç”¨æœ€ç®€å•çš„4ä¸ªå‚æ•°è¿›è¡Œé¢„æµ‹ï¼š
```bash
curl -X POST 'http://localhost:8002/api/v3/predict' \
  -H 'Content-Type: application/json' \
  -d '{
    "current_date": "2024-06-01",
    "predict_days": 7,
    "station": "èƒ¥æ¹–å¿ƒ",
    "model_type": "grud"
  }'
```

## ğŸ“ æ ¸å¿ƒå‚æ•°è¯¦è§£

### 1. current_date (å½“å‰æ—¥æœŸ)
- **æ ¼å¼**: YYYY-MM-DD
- **å«ä¹‰**: é¢„æµ‹çš„èµ·å§‹æ—¥æœŸï¼Œç³»ç»Ÿä¼šä»è¿™ä¸ªæ—¥æœŸå¼€å§‹é¢„æµ‹æœªæ¥Nå¤©
- **ç¤ºä¾‹**: "2024-06-01"
- **è¯´æ˜**: ç³»ç»Ÿä¼šè‡ªåŠ¨è·å–åˆ°æ­¤æ—¥æœŸå‰ä¸€å¤©ä¸ºæ­¢çš„60å¤©å†å²æ•°æ®

### 2. predict_days (é¢„æµ‹å¤©æ•°)
- **èŒƒå›´**: 1-30å¤©
- **å«ä¹‰**: ä»å½“å‰æ—¥æœŸå¼€å§‹ï¼Œé¢„æµ‹æœªæ¥å¤šå°‘å¤©
- **ç¤ºä¾‹**: 7 (é¢„æµ‹æœªæ¥7å¤©)
- **æ¨è**: 
  - çŸ­æœŸé¢„è­¦: 1-7å¤©
  - ä¸­æœŸè§„åˆ’: 8-15å¤©  
  - é•¿æœŸé¢„æµ‹: 16-30å¤©

### 3. station (ç›‘æµ‹ç«™ç‚¹)
- **å¯é€‰å€¼**: 
  - "èƒ¥æ¹–å¿ƒ" (æ¨èæ¨¡å‹: grud)
  - "é”¡ä¸œæ°´å‚" (æ¨èæ¨¡å‹: grud)
  - "å¹³å°å±±" (æ¨èæ¨¡å‹: xgboost)
  - "tuoshan" (æ¨èæ¨¡å‹: grud)
  - "lanshanzui" (æ¨èæ¨¡å‹: grud)
  - "äº”é‡Œæ¹–å¿ƒ" (æ¨èæ¨¡å‹: grud)
- **ç¤ºä¾‹**: "èƒ¥æ¹–å¿ƒ"

### 4. model_type (æ¨¡å‹ç±»å‹)
- **å¯é€‰å€¼**:
  - "grud" - GRU-Dæ¨¡å‹ (æ¨èï¼Œç²¾åº¦é«˜)
  - "lstm" - LSTMæ¨¡å‹ (åŸºå‡†æ¨¡å‹)
  - "tcn" - TCNæ¨¡å‹ (é€Ÿåº¦å¿«)
  - "xgboost" - XGBoostæ¨¡å‹ (åœ¨å¹³å°å±±è¡¨ç°æœ€ä½³)
- **ç¤ºä¾‹**: "grud"
- **å»ºè®®**: å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½¿ç”¨"grud"ï¼Œå¹³å°å±±ç«™ç‚¹ä½¿ç”¨"xgboost"

## ğŸŒŸ å®é™…ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: æ—¥å¸¸ç›‘æµ‹é¢„è­¦ (1-7å¤©)
**ä¸šåŠ¡éœ€æ±‚**: ç¯ä¿éƒ¨é—¨éœ€è¦äº†è§£èƒ¥æ¹–å¿ƒç«™ç‚¹æœªæ¥ä¸€å‘¨çš„è“è—»æƒ…å†µ

```bash
curl -X POST 'http://localhost:8002/api/v3/predict' \
  -H 'Content-Type: application/json' \
  -d '{
    "current_date": "2024-06-01",
    "predict_days": 7,
    "station": "èƒ¥æ¹–å¿ƒ",
    "model_type": "grud"
  }'
```

**å“åº”è§£è¯»**:
```json
{
    "success": true,
    "data": {
        "prediction": [0.4706, 0.4192, 0.4954, 0.3341, 0.2284, 0.1289, 0.0241],
        "prediction_dates": [
            "2024-06-01", "2024-06-02", "2024-06-03", 
            "2024-06-04", "2024-06-05", "2024-06-06", "2024-06-07"
        ]
    },
    "message": "æˆåŠŸç”Ÿæˆèƒ¥æ¹–å¿ƒä»2024-06-01å¼€å§‹æœªæ¥7å¤©çš„æ¨¡æ‹Ÿè“è—»å¯†åº¦é¢„æµ‹"
}
```

### åœºæ™¯2: ä¸­æœŸæ²»ç†è§„åˆ’ (15å¤©)
**ä¸šåŠ¡éœ€æ±‚**: åˆ¶å®šåŠæœˆæ²»ç†è®¡åˆ’

```bash
curl -X POST 'http://localhost:8002/api/v3/predict' \
  -H 'Content-Type: application/json' \
  -d '{
    "current_date": "2024-06-01",
    "predict_days": 15,
    "station": "é”¡ä¸œæ°´å‚",
    "model_type": "grud"
  }'
```

### åœºæ™¯3: é•¿æœŸé¢„æµ‹åˆ†æ (30å¤©)
**ä¸šåŠ¡éœ€æ±‚**: æœˆåº¦è“è—»é£é™©è¯„ä¼°

```bash
curl -X POST 'http://localhost:8002/api/v3/predict' \
  -H 'Content-Type: application/json' \
  -d '{
    "current_date": "2024-06-01",
    "predict_days": 30,
    "station": "å¹³å°å±±",
    "model_type": "xgboost"
  }'
```

### åœºæ™¯4: å¤šç«™ç‚¹å¯¹æ¯”åˆ†æ
**ä¸šåŠ¡éœ€æ±‚**: åŒæ—¶ç›‘æµ‹å¤šä¸ªå…³é”®ç«™ç‚¹

```bash
curl -X POST 'http://localhost:8002/api/v3/batch-predict' \
  -H 'Content-Type: application/json' \
  -d '{
    "requests": [
      {
        "current_date": "2024-06-01",
        "predict_days": 7,
        "station": "èƒ¥æ¹–å¿ƒ",
        "model_type": "grud"
      },
      {
        "current_date": "2024-06-01",
        "predict_days": 7,
        "station": "é”¡ä¸œæ°´å‚",
        "model_type": "grud"
      },
      {
        "current_date": "2024-06-01",
        "predict_days": 7,
        "station": "å¹³å°å±±",
        "model_type": "xgboost"
      }
    ],
    "parallel_execution": true
  }'
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### è¯·æ±‚éªŒè¯
åœ¨å‘é€é¢„æµ‹è¯·æ±‚å‰ï¼Œå¯ä»¥å…ˆéªŒè¯è¯·æ±‚çš„å¯è¡Œæ€§ï¼š

```bash
curl -X POST 'http://localhost:8002/api/v3/validate' \
  -H 'Content-Type: application/json' \
  -d '{
    "current_date": "2024-06-01",
    "predict_days": 7,
    "station": "èƒ¥æ¹–å¿ƒ",
    "model_type": "grud"
  }'
```

**å“åº”ä¿¡æ¯åŒ…æ‹¬**:
- è¯·æ±‚æ˜¯å¦æœ‰æ•ˆ
- æ•°æ®å¯ç”¨æ€§ä¿¡æ¯
- æ¨¡å‹æ¨èå»ºè®®
- è‡ªåŠ¨è®¡ç®—çš„å†å²æ•°æ®æˆªæ­¢æ—¥æœŸ

### è·å–é…ç½®ä¿¡æ¯

æŸ¥çœ‹æ”¯æŒçš„ç«™ç‚¹åˆ—è¡¨ï¼š
```bash
curl http://localhost:8002/api/stations
```

æŸ¥çœ‹æ”¯æŒçš„æ¨¡å‹ç±»å‹ï¼š
```bash
curl http://localhost:8002/api/models
```

æŸ¥çœ‹APIè¾“å…¥æ ¼å¼è¯´æ˜ï¼š
```bash
curl http://localhost:8002/api/v3/input-schema
```

## ğŸ¯ æœ€ä½³å®è·µå»ºè®®

### 1. ç«™ç‚¹å’Œæ¨¡å‹é€‰æ‹©
| ç«™ç‚¹åç§° | æ¨èæ¨¡å‹ | æ”¹å–„ç‡ | é€‚ç”¨åœºæ™¯ |
|---------|----------|--------|----------|
| èƒ¥æ¹–å¿ƒ | grud | 77.4% | é‡æ±¡æŸ“åŒºåŸŸç›‘æµ‹ |
| é”¡ä¸œæ°´å‚ | grud | 55.1% | æ°´æºåœ°ä¿æŠ¤ |
| å¹³å°å±± | xgboost | 100% | èƒŒæ™¯åŒºåŸŸç›‘æµ‹ |
| tuoshan | grud | 79.8% | è¾¹ç•Œæ¡ä»¶ç›‘æµ‹ |
| lanshanzui | grud | 28.8% | å…¥æ¹–å£ç›‘æµ‹ |
| äº”é‡Œæ¹–å¿ƒ | grud | 42.9% | æ¹–å¿ƒåŒºåŸŸç›‘æµ‹ |

### 2. é¢„æµ‹å¤©æ•°é€‰æ‹©
- **1-3å¤©**: åº”æ€¥å“åº”ï¼Œç²¾åº¦æœ€é«˜
- **4-7å¤©**: æ—¥å¸¸ç›‘æµ‹ï¼Œå¹³è¡¡ç²¾åº¦å’Œå®ç”¨æ€§
- **8-15å¤©**: ä¸­æœŸè§„åˆ’ï¼Œè¶‹åŠ¿åˆ†æ
- **16-30å¤©**: é•¿æœŸé¢„æµ‹ï¼Œå­£èŠ‚æ€§è§„å¾‹

### 3. æ—¶é—´è®¾ç½®å»ºè®®
- **current_date**: å»ºè®®è®¾ç½®ä¸ºå½“å‰æ—¥æœŸæˆ–æœ€æ–°æ•°æ®æ—¥æœŸ
- **å†å²æ•°æ®**: ç³»ç»Ÿè‡ªåŠ¨è·å–current_dateå‰60å¤©çš„æ•°æ®
- **é¢„æµ‹èŒƒå›´**: ä»current_dateå¼€å§‹çš„è¿ç»­Nå¤©

## âš ï¸ å¸¸è§é—®é¢˜ä¸è§£å†³

### Q1: é¢„æµ‹å¤©æ•°è¶…è¿‡30å¤©æ€ä¹ˆåŠï¼Ÿ
**é”™è¯¯ä¿¡æ¯**: "Input should be less than or equal to 30"
**è§£å†³æ–¹æ¡ˆ**: å°†predict_daysè®¾ç½®ä¸º1-30ä¹‹é—´çš„å€¼

### Q2: ç«™ç‚¹åç§°å†™é”™äº†æ€ä¹ˆåŠï¼Ÿ
**é”™è¯¯ä¿¡æ¯**: "ä¸æ”¯æŒçš„ç›‘æµ‹ç«™ç‚¹"
**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥stationå‚æ•°ï¼Œä½¿ç”¨å‡†ç¡®çš„ç«™ç‚¹åç§°

### Q3: æ¨¡å‹ç±»å‹ä¸å­˜åœ¨æ€ä¹ˆåŠï¼Ÿ
**é”™è¯¯ä¿¡æ¯**: "ä¸æ”¯æŒçš„æ¨¡å‹ç±»å‹"
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨grudã€lstmã€tcnã€xgboostä¸­çš„ä¸€ä¸ª

### Q4: æ—¥æœŸæ ¼å¼ä¸æ­£ç¡®æ€ä¹ˆåŠï¼Ÿ
**é”™è¯¯ä¿¡æ¯**: "æ—¥æœŸæ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä¸º YYYY-MM-DD"
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨æ ‡å‡†æ ¼å¼ï¼Œå¦‚"2024-06-01"

### Q5: æœåŠ¡æ— æ³•è¿æ¥æ€ä¹ˆåŠï¼Ÿ
**é”™è¯¯ä¿¡æ¯**: è¿æ¥è¶…æ—¶æˆ–æ‹’ç»è¿æ¥
**è§£å†³æ–¹æ¡ˆ**: 
1. æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨: `python main_v3.py`
2. æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®: 8002
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

## ğŸ–¥ï¸ æµè§ˆå™¨ä¸­ä½¿ç”¨

### è®¿é—®APIæ–‡æ¡£
åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€: http://localhost:8002/docs

è¿™é‡Œæä¾›äº†å®Œæ•´çš„äº¤äº’å¼APIæ–‡æ¡£ï¼Œå¯ä»¥ç›´æ¥åœ¨ç½‘é¡µä¸­æµ‹è¯•æ‰€æœ‰æ¥å£ã€‚

### ä½¿ç”¨Swaggerç•Œé¢
1. æ‰“å¼€APIæ–‡æ¡£é¡µé¢
2. æ‰¾åˆ°`/api/v3/predict`æ¥å£
3. ç‚¹å‡»"Try it out"
4. å¡«å…¥4ä¸ªå‚æ•°
5. ç‚¹å‡»"Execute"æ‰§è¡Œ

## ğŸ“Š ç¼–ç¨‹è¯­è¨€ç¤ºä¾‹

### Pythonç¤ºä¾‹
```python
import requests

def predict_algae():
    url = "http://localhost:8002/api/v3/predict"
    
    data = {
        "current_date": "2024-06-01",
        "predict_days": 7,
        "station": "èƒ¥æ¹–å¿ƒ",
        "model_type": "grud"
    }
    
    response = requests.post(url, json=data)
    result = response.json()
    
    if result['success']:
        predictions = result['data']['prediction']
        dates = result['data']['prediction_dates']
        
        print("é¢„æµ‹ç»“æœ:")
        for i, (date, pred) in enumerate(zip(dates, predictions)):
            print(f"{date}: {pred:.4f}")
    else:
        print("é¢„æµ‹å¤±è´¥:", result.get('detail', 'æœªçŸ¥é”™è¯¯'))

# è°ƒç”¨å‡½æ•°
predict_algae()
```

### JavaScriptç¤ºä¾‹
```javascript
async function predictAlgae() {
    const url = 'http://localhost:8002/api/v3/predict';
    
    const data = {
        current_date: '2024-06-01',
        predict_days: 7,
        station: 'èƒ¥æ¹–å¿ƒ',
        model_type: 'grud'
    };
    
    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            console.log('é¢„æµ‹ç»“æœ:', result.data.prediction);
            console.log('é¢„æµ‹æ—¥æœŸ:', result.data.prediction_dates);
        } else {
            console.error('é¢„æµ‹å¤±è´¥:', result.detail);
        }
    } catch (error) {
        console.error('è¯·æ±‚å¼‚å¸¸:', error);
    }
}

// è°ƒç”¨å‡½æ•°
predictAlgae();
```

## ğŸ‰ æ€»ç»“

V3ç‰ˆæœ¬çš„è“è—»é¢„æµ‹ç³»ç»ŸAPIå®ç°äº†ï¼š

### âœ… æç®€æ˜“ç”¨
- ä»720ä¸ªå‚æ•°å‡å°‘åˆ°4ä¸ªå‚æ•°
- ä»ä¸“å®¶çº§å·¥å…·å˜æˆäººäººå¯ç”¨çš„æœåŠ¡
- æ— éœ€æŠ€æœ¯èƒŒæ™¯å³å¯ä½¿ç”¨

### âœ… åŠŸèƒ½å¼ºå¤§
- æ”¯æŒ1-30å¤©ä»»æ„é•¿åº¦é¢„æµ‹
- è¦†ç›–å¤ªæ¹–æµåŸŸ6ä¸ªå…³é”®ç›‘æµ‹ç«™ç‚¹
- æä¾›4ç§å…ˆè¿›çš„æœºå™¨å­¦ä¹ æ¨¡å‹

### âœ… æ™ºèƒ½è‡ªåŠ¨
- è‡ªåŠ¨è·å–å†å²æ•°æ®
- è‡ªåŠ¨é¢„å¤„ç†å’Œæ ‡å‡†åŒ–
- è‡ªåŠ¨æ¨¡å‹æ¨ç†å’Œç»“æœä¼˜åŒ–

### âœ… ç”Ÿäº§å°±ç»ª
- æ¯«ç§’çº§å“åº”æ—¶é—´
- æ”¯æŒé«˜å¹¶å‘æ‰¹é‡å¤„ç†
- å®Œå–„çš„é”™è¯¯å¤„ç†å’ŒéªŒè¯

V3ç‰ˆæœ¬çœŸæ­£å®ç°äº†"ç”¨æœ€å°‘çš„è¾“å…¥ï¼Œè·å¾—æœ€å‡†ç¡®çš„é¢„æµ‹"çš„è®¾è®¡ç›®æ ‡ï¼Œä¸ºè“è—»æ°´åçš„é¢„é˜²å’Œæ²»ç†æä¾›äº†ç§‘å­¦å¯é ã€ç®€å•æ˜“ç”¨çš„é¢„æµ‹å·¥å…·ï¼

---
**æ–‡æ¡£åˆ›å»ºæ—¥æœŸ**: 2024-08-17  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**é€‚ç”¨ç‰ˆæœ¬**: è“è—»é¢„æµ‹ç³»ç»ŸAPI V3.0.0  
**æ›´æ–°è®°å½•**: åˆç‰ˆå‘å¸ƒ
